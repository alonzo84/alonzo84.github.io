<!-- Configurando el documento HTML con dependencias -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Informe de Voto Desinformado</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.15.0/Recharts.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body className="bg-gray-100 font-sans">
  <!-- Contenedor principal -->
  <div id="root" className="container mx-auto p-6"></div>

  <!-- Componente React con JSX -->
  <script type="text/babel">
    const Report = () => {
      const [data, setData] = React.useState(null);
      const [loading, setLoading] = React.useState(true);

      // Cargando y procesando los datos del CSV
      React.useEffect(() => {
        const csv = loadFileData("voto desinformado - Sheet1.csv");
        Papa.parse(csv, {
          header: true,
          skipEmptyLines: true,
          transformHeader: (header) => header.trim().replace(/^"|"$/g, ''),
          transform: (value, header) => value.trim().replace(/^"|"$/g, ''),
          complete: (results) => {
            // Limpiando y procesando los datos
            const cleanedData = results.data.map(row => {
              const vote = row["Vota por"];
              if (!vote) return null; // Filtrar filas vacías
              if (vote.toUpperCase() === "NO CONZCO" || vote.toUpperCase() === "NO LOS CONOCE") {
                return { vote: "No conoce" };
              }
              return { vote };
            }).filter(row => row !== null);

            // Contando frecuencias para las visualizaciones
            const voteCounts = cleanedData.reduce((acc, row) => {
              acc[row.vote] = (acc[row.vote] || 0) + 1;
              return acc;
            }, {});

            const chartData = Object.entries(voteCounts).map(([name, count]) => ({
              name,
              count
            }));

            setData({ raw: cleanedData, chartData });
            setLoading(false);
          },
          error: (err) => {
            console.error(err);
            setLoading(false);
          }
        });
      }, []);

      // Mostrando mensaje de carga
      if (loading) {
        return (
          <div className="text-center text-xl font-semibold text-gray-700">
            Cargando datos...
          </div>
        );
      }

      // Preparando datos para el gráfico de pastel
      const totalVotes = data.chartData.reduce((sum, item) => sum + item.count, 0);
      const noConoceCount = data.chartData.find(item => item.name === "No conoce")?.count || 0;
      const ningunoCount = data.chartData.find(item => item.name === "Ninguno")?.count || 0;
      const candidateCount = totalVotes - noConoceCount - ningunoCount;
      const pieData = [
        { name: "No conoce", value: noConoceCount },
        { name: "Ninguno", value: ningunoCount },
        { name: "Candidatos", value: candidateCount }
      ].filter(item => item.value > 0); // Filtrar categorías sin votos

      // Renderizando el informe
      return (
        <div className="bg-white rounded-lg shadow-lg p-6">
          {/* Resumen */}
          <h1 className="text-3xl font-bold text-gray-800 mb-4">Informe de Voto Desinformado</h1>
          <p className="text-gray-600 mb-6">
            Este informe analiza las preferencias de voto de encuestados que declararon no conocer a ningún candidato. La columna "Vota por" refleja las respuestas de estas personas, mostrando si eligieron un candidato, "Ninguno", o reiteraron que no conocen a los candidatos ("No conoce"). Se presentan visualizaciones para entender cómo se distribuyen estas respuestas.
          </p>

          {/* Gráfico de barras */}
          <h2 className="text-2xl font-semibold text-gray-700 mb-4">Distribución de Respuestas</h2>
          <div className="mb-8">
            <Recharts.ResponsiveContainer width="100%" height={400}>
              <Recharts.BarChart data={data.chartData}>
                <Recharts.CartesianGrid strokeDasharray="3 3" />
                <Recharts.XAxis dataKey="name" fontSize={12} />
                <Recharts.YAxis fontSize={12} />
                <Recharts.Tooltip />
                <Recharts.Legend />
                <Recharts.Bar dataKey="count" fill="#3B82F6" />
              </Recharts.BarChart>
            </Recharts.ResponsiveContainer>
          </div>

          {/* Gráfico de pastel */}
          <h2 className="text-2xl font-semibold text-gray-700 mb-4">Proporción de Respuestas</h2>
          <div className="mb-8">
            <Recharts.ResponsiveContainer width="100%" height={400}>
              <Recharts.PieChart>
                <Recharts.Pie
                  data={pieData}
                  dataKey="value"
                  nameKey="name"
                  cx="50%"
                  cy="50%"
                  outerRadius={150}
                  fill="#8884d8"
                  label={{ fontSize: 12 }}
                >
                  {pieData.map((entry, index) => (
                    <Recharts.Cell
                      key={`cell-${index}`}
                      fill={index === 0 ? '#EF4444' : index === 1 ? '#F59E0B' : '#10B981'}
                    />
                  ))}
                </Recharts.Pie>
                <Recharts.Tooltip />
                <Recharts.Legend />
              </Recharts.PieChart>
            </Recharts.ResponsiveContainer>
          </div>

          {/* Conclusiones */}
          <h2 className="text-2xl font-semibold text-gray-700 mb-4">Conclusiones</h2>
          <p className="text-gray-600">
            De un total de {totalVotes} respuestas válidas de encuestados que no conocen a los candidatos, 
            {noConoceCount} ({((noConoceCount / totalVotes) * 100).toFixed(2)}%) reiteraron "No conoce", 
            {ningunoCount} ({((ningunoCount / totalVotes) * 100).toFixed(2)}%) eligieron "Ninguno", 
            y {candidateCount} ({((candidateCount / totalVotes) * 100).toFixed(2)}%) seleccionaron un candidato. 
            Esto sugiere que, a pesar de no conocer a los candidatos, una proporción significativa ({((candidateCount / totalVotes) * 100).toFixed(2)}%) optó por votar por alguien, lo que podría indicar decisiones basadas en factores distintos al conocimiento, como reconocimiento de nombres o influencias externas. La elección de "Ninguno" o "No conoce" refleja una mayor coherencia con el desconocimiento declarado, pero la preferencia por candidatos específicos plantea preguntas sobre la naturaleza del voto desinformado.
          </p>
        </div>
      );
    };

    // Renderizando el componente
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<Report />);
  </script>
</body>
</html>